# Load any .envrc files up the directory tree
source_up

# Load default .env file if exists
dotenv_if_exists

# Load environment-specific overrides if APP_ENV is set and file exists
if [ -n "$APP_ENV" ]; then
  test -f ".env.$APP_ENV" && dotenv ".env.$APP_ENV"
fi

# Load local overrides last
test -f .env.local && dotenv .env.local

# Default APP_ENV if not set
export APP_ENV=${APP_ENV:-dev}

# Set correct kubeconfig based on APP_ENV
if [ "$APP_ENV" = "dev" ]; then
  export KUBECONFIG="$HOME/.kube/config-rwml-dev"
elif [ "$APP_ENV" = "prod" ]; then
  export KUBECONFIG="$HOME/.kube/config-rwml-prod"
fi

echo "[direnv] APP_ENV=$APP_ENV | KUBECONFIG=$KUBECONFIG"

